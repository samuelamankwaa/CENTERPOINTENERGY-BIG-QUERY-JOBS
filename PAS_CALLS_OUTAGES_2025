SELECT DISTINCT
       ef.EVENTNAME,
       ef.SERVICECENTER,
       ef.STARTDATETIME,
       ef.RESTOREDDATETIME,
       cf.CALLERTYPE,
       ef.TROUBLE_LVL,
       cf.CALLCODE,
       cf.CALLDESC,
       cf.NO_CALLS AS NUM_OF_CALLS,
       ss.ACTION_TAKEN_1, 
       ss.ACTION_TAKEN_2, 
       ss.ACTION_TAKEN_3, 
       ss.ACTION_TAKEN_4, 
       ss.ACTION_TAKEN_5, 
       ss.ACTION_TAKEN_6, 
       ss.CREW_NOTES AS COMMENTS,     
       ef.DEVICENAME,     
       ef.DURATIONHM
 FROM `cnp-datafoundation-prod.TECHOPS_FOCALPOINT_VIEWS.V_OMS_EVENT_FACT` ef
 LEFT JOIN `cnp-datafoundation-prod.TECHOPS_FOCALPOINT_VIEWS.V_OMS_SERVICE_SUITE` ss  ON ef.EVENTNAME = ss.EVENTNAME
 LEFT JOIN  `cnp-datafoundation-prod.TECHOPS_FOCALPOINT_VIEWS.V_OMS_CALL_FACT` cf ON cf.EVENTKEY = ef.EVENTKEY
  WHERE ef.STARTDATETIME >= DATETIME("2025-01-01T00:00:00") 
   AND ef.STARTDATETIME < DATETIME("2025-05-28T23:59:59")
   AND ef.EXCLUDETROUBLEFLAG = 0
   AND ef.MOMENTARYOUTAGEFLAG = 0
   AND ef.CANCELLEDFLAG = 0
   AND ef.PLANNEDOTGFLAG = 0
   AND ef.NONOUTGCALLFLAG = 0
   AND ef.ORPHANOUTAGEFLAG = 0
   AND ef.SERVICECENTER NOT IN ('BV', 'EV', 'FB', 'MV', 'RP','INDIANA')
--   AND ef.TROUBLE_LVL = 'F'  
   AND cf.CALLERTYPE = 'PAS'
   AND ef.FEEDERNAME != '-Missing Feeder-'

   GROUP BY ef.EVENTNAME, ss.EVENTNAME,ef.STARTDATETIME,ef.RESTOREDDATETIME,ef.SUBSTATIONNAME,ef.DURATIONHM, ef.SERVICECENTER,ss.CREW_NOTES,ef.TROUBLE_LVL, 
    ef.DEVICENAME,cf.NO_CALLS, cf.CALLCODE,cf.CALLDESC,cf.CALLERTYPE,ss.ACTION_TAKEN_1, ss.ACTION_TAKEN_2, ss.ACTION_TAKEN_3, 
                 ss.ACTION_TAKEN_4, ss.ACTION_TAKEN_5, ss.ACTION_TAKEN_6
    ORDER BY  ef.STARTDATETIME, ef.RESTOREDDATETIME

---SELECT * FROM `cnp-datafoundation-prod.TECHOPS_FOCALPOINT_VIEWS.V_OMS_SERVICE_SUITE` LIMIT 100

--SELECT * FROM `cnp-datafoundation-prod.TECHOPS_FOCALPOINT_VIEWS.V_OMS_EVENT_FACT` LIMIT 10
--SELECT DISTINCT CALLCODE FROM `cnp-datafoundation-prod.TECHOPS_FOCALPOINT_VIEWS.V_OMS_CALL_FACT` 
