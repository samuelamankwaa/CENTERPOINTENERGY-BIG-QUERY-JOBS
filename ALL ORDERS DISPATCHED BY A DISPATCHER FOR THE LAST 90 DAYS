SELECT DISTINCT
A.OrderNumber,
A.OrderType,
B.SERVICECENTER,
B.TROUBLELEVEL,
B.CAUSENAME,
B.ACTUALPERIODSTART AS OutageDT,
A.OrderData.WorkOrderRecord.HazardLevelCode,
A.Tasks.WorkOrderTask.TaskTracking.EventByUserId AS DispatchedBy,
A.Tasks.WorkOrderTask.TaskAssignment.UserId AS DispatchedTo,
DATETIME(A.Tasks.WorkOrderTask.TaskTracking.DispatchedAt,"America/Chicago") AS DispatchedAt
FROM `cnp-datafoundation-prod.EAI_ELEC_OPS.T_ELEC_ORDER_TASKS` A
LEFT JOIN `cnp-datafoundation-prod.ADMS_OEP.T_FPRP_OUTAGE_HIST` B ON   B.EVENTNAME = A.OrderNumber
AND
B.ACTUALPERIODSTART BETWEEN DATETIME_SUB(CURRENT_DATETIME(), INTERVAL 90 DAY) AND CURRENT_DATETIME()
AND
B.MOMENTARYOUTAGEFLAG = 0
AND
B.ISPLANNED = 0
AND
B.CANCELLEDFLAG = 0
AND
B.EVENTNAME NOT LIKE '%.%'
AND
B.CAUSENAME NOT LIKE 'PS%'
AND
B.STATE = 'TX'
WHERE
TIMESTAMP_TRUNC(A.OrderUpdateTS, DAY) BETWEEN TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 90 DAY) AND CURRENT_TIMESTAMP()
--AND
--A.OrderNumber IS NOT NULL
---AND
--A.OrderStatus = 'UnAcknowledged'
AND (
  A.Tasks.WorkOrderTask.TaskTracking.EventByUserId LIKE '%Belman01%'
  OR A.Tasks.WorkOrderTask.TaskTracking.EventByUserId LIKE '%Belman02%'
  OR A.Tasks.WorkOrderTask.TaskTracking.EventByUserId LIKE '%Belman03%'
  OR A.Tasks.WorkOrderTask.TaskTracking.EventByUserId LIKE '%BELMAN01%'
  OR A.Tasks.WorkOrderTask.TaskTracking.EventByUserId LIKE '%BELMAN02%'
  OR A.Tasks.WorkOrderTask.TaskTracking.EventByUserId LIKE '%BELMAN03%'
  OR A.Tasks.WorkOrderTask.TaskTracking.EventByUserId LIKE '%BEL%'
  OR A.Tasks.WorkOrderTask.TaskTracking.EventByUserId LIKE '%Bel%'
) 
ORDER BY A.OrderNumber,OutageDT, DispatchedAt, DispatchedBy
